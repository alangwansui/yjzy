# -*- coding: utf-8 -*-
# Copyright 2017 Jarvis (www.odoomod.com)
# License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).

from odoo import models, fields, api, SUPERUSER_ID


class AccountAccount(models.Model):
    _inherit = 'account.account'

    balance_direction = fields.Selection([('debit', '借方'), ('credit', '贷方')], string='余额方向')
    view_type = fields.Boolean(string='视图类型',help='只显示汇总数')
    ledger_format = fields.Selection([('amount', '金额式'), ('quantity', '数量金额式'), ('currency', '外币金额式')], '账页格式')

    @api.model_cr
    def init(self):
        account_config = [
            ['1001', '库存现金', '借方', ''],
            ['1002', '银行存款', '借方', ''],
            ['1003', '存放中央银行款项', '借方', ''],
            ['1011', '存放同业', '借方', ''],
            ['1012', '其他货币资金', '借方', ''],
            ['1021', '结算备付金', '借方', ''],
            ['1031', '存出保证金', '借方', ''],
            ['1101', '交易性金融资产', '借方', ''],
            ['1111', '买入返售金融资产', '借方', ''],
            ['1121', '应收票据', '借方', ''],
            ['1122', '应收账款', '借方', ''],
            ['1123', '预付账款', '借方', ''],
            ['1131', '应收股利', '借方', ''],
            ['1132', '应收利息', '借方', ''],
            ['1201', '应收代位追偿款', '借方', ''],
            ['1211', '应收分保账款', '借方', ''],
            ['1212', '应收分保合同准备金', '借方', ''],
            ['1221', '其他应收款', '借方', ''],
            ['1231', '坏账准备', '贷方', ''],
            ['1301', '贴现资产', '借方', ''],
            ['1302', '拆出资金', '借方', ''],
            ['1303', '贷款', '借方', ''],
            ['1304', '贷款损失准备', '贷方', ''],
            ['1311', '代理兑付证券', '借方', ''],
            ['1321', '代理业务资产', '借方', ''],
            ['1401', '材料采购', '借方', ''],
            ['1402', '在途物资', '借方', ''],
            ['1403', '原材料', '借方', ''],
            ['1404', '材料成本差异', '借方', ''],
            ['1405', '库存商品', '借方', ''],
            ['1406', '发出商品', '借方', ''],
            ['1407', '商品进销差价', '借方', ''],
            ['1408', '委托加工物资', '借方', ''],
            ['1411', '周转材料', '借方', ''],
            ['1421', '消耗性生物资产', '借方', ''],
            ['1431', '贵金属', '借方', ''],
            ['1441', '抵债资产', '借方', ''],
            ['1451', '损余物资', '借方', ''],
            ['1461', '融资租赁资产', '借方', ''],
            ['1471', '存货跌价准备', '贷方', ''],
            ['1501', '持有至到期投资', '借方', ''],
            ['1502', '持有至到期投资减值准备', '贷方', ''],
            ['1503', '可供出售金融资产', '借方', ''],
            ['1511', '长期股权投资', '借方', ''],
            ['1512', '长期股权投资减值准备', '贷方', ''],
            ['1521', '投资性房地产', '借方', ''],
            ['1531', '长期应收款', '借方', ''],
            ['1532', '未实现融资收益', '贷方', ''],
            ['1541', '存出资本保证金', '借方', ''],
            ['1601', '固定资产', '借方', ''],
            ['1602', '累计折旧', '贷方', ''],
            ['1603', '固定资产减值准备', '贷方', ''],
            ['1604', '在建工程', '借方', ''],
            ['1605', '工程物资', '借方', ''],
            ['1606', '固定资产清理', '借方', ''],
            ['1611', '未担保余值', '借方', ''],
            ['1621', '生产性生物资产', '借方', ''],
            ['1622', '生产性生物资产累计折旧', '贷方', ''],
            ['1623', '公益性生物资产', '借方', ''],
            ['1631', '油气资产', '借方', ''],
            ['1632', '累计折耗', '贷方', ''],
            ['1701', '无形资产', '借方', ''],
            ['1702', '累计摊销', '贷方', ''],
            ['1703', '无形资产减值准备', '贷方', ''],
            ['1711', '商誉', '借方', ''],
            ['1801', '长期待摊费用', '借方', ''],
            ['1811', '递延所得税资产', '借方', ''],
            ['1821', '独立账户资产', '借方', ''],
            ['1901', '待处理财产损溢', '借方', ''],
            ['2001', '短期借款', '贷方', ''],
            ['2002', '存入保证金', '贷方', ''],
            ['2003', '拆入资金', '贷方', ''],
            ['2004', '向中央银行借款', '贷方', ''],
            ['2011', '吸收存款', '贷方', ''],
            ['2012', '同业存放', '贷方', ''],
            ['2021', '贴现负债', '贷方', ''],
            ['2101', '交易性金融负债', '贷方', ''],
            ['2111', '卖出回购金融资产款', '贷方', ''],
            ['2201', '应付票据', '贷方', ''],
            ['2202', '应付账款', '贷方', ''],
            ['2203', '预收账款', '贷方', ''],
            ['2211', '应付职工薪酬', '贷方', ''],
            ['2221', '应交税费', '贷方', ''],
            ['2221.01', '应交增值税', '贷方', '应交税费'],
            ['2221.01.01', '进项税额', '贷方', '应交增值税'],
            ['2221.01.02', '销项税额', '贷方', '应交增值税'],
            ['2221.01.03', '出口退税', '贷方', '应交增值税'],
            ['2221.01.04', '进项税额转出', '贷方', '应交增值税'],
            ['2221.01.05', '已交税金', '贷方', '应交增值税'],
            ['2221.02', '应交城市维护建设税', '贷方', '应交税费'],
            ['2221.03', '应交教育费附加', '贷方', '应交税费'],
            ['2221.04', '应交车船税', '贷方', '应交税费'],
            ['2221.05', '应交房产税', '贷方', '应交税费'],
            ['2221.06', '应交城镇土地使用税', '贷方', '应交税费'],
            ['2221.07', '应交资源税', '贷方', '应交税费'],
            ['2221.08', '应交矿产资源税', '贷方', '应交税费'],
            ['2221.09', '应交企业所得税', '贷方', '应交税费'],
            ['2231', '应付利息', '贷方', ''],
            ['2232', '应付股利', '贷方', ''],
            ['2241', '其他应付款', '贷方', ''],
            ['2251', '应付保单红利', '贷方', ''],
            ['2261', '应付分保账款', '贷方', ''],
            ['2311', '代理买卖证券款', '贷方', ''],
            ['2312', '代理承销证券款', '贷方', ''],
            ['2313', '代理兑付证券款', '贷方', ''],
            ['2314', '代理业务负债', '贷方', ''],
            ['2401', '递延收益', '贷方', ''],
            ['2501', '长期借款', '贷方', ''],
            ['2502', '应付债券', '贷方', ''],
            ['2601', '未到期责任准备金', '贷方', ''],
            ['2602', '保险责任准备金', '贷方', ''],
            ['2611', '保户储金', '贷方', ''],
            ['2621', '独立账户负债', '贷方', ''],
            ['2701', '长期应付款', '贷方', ''],
            ['2702', '未确认融资费用', '借方', ''],
            ['2711', '专项应付款', '贷方', ''],
            ['2801', '预计负债', '贷方', ''],
            ['2901', '递延所得税负债', '贷方', ''],
            ['3001', '清算资金往来', '借方', ''],
            ['3002', '货币兑换', '借方', ''],
            ['3101', '衍生工具', '借方', ''],
            ['3201', '套期工具', '借方', ''],
            ['3202', '被套期项目', '借方', ''],
            ['4001', '实收资本', '贷方', ''],
            ['4002', '资本公积', '贷方', ''],
            ['4101', '盈余公积', '贷方', ''],
            ['4102', '一般风险准备', '贷方', ''],
            ['4103', '本年利润', '贷方', ''],
            ['4104', '利润分配', '贷方', ''],
            ['4201', '库存股', '贷方', ''],
            ['5001', '生产成本', '借方', ''],
            ['5101', '制造费用', '借方', ''],
            ['5201', '劳务成本', '借方', ''],
            ['5301', '研发支出', '借方', ''],
            ['5401', '工程施工', '借方', ''],
            ['5402', '工程结算', '借方', ''],
            ['5403', '机械作业', '借方', ''],
            ['6001', '主营业务收入', '贷方', ''],
            ['6011', '利息收入', '贷方', ''],
            ['6021', '手续费及佣金收入', '贷方', ''],
            ['6031', '保费收入', '贷方', ''],
            ['6041', '租赁收入', '贷方', ''],
            ['6051', '其他业务收入', '贷方', ''],
            ['6061', '汇兑损益', '贷方', ''],
            ['6101', '公允价值变动损益', '贷方', ''],
            ['6111', '投资收益', '贷方', ''],
            ['6201', '摊回保险责任准备金', '贷方', ''],
            ['6202', '摊回赔付支出', '贷方', ''],
            ['6203', '摊回分保费用', '贷方', ''],
            ['6301', '营业外收入', '贷方', ''],
            ['6401', '主营业务成本', '借方', ''],
            ['6402', '其他业务成本', '借方', ''],
            ['6403', '营业税金及附加', '借方', ''],
            ['6411', '利息支出', '借方', ''],
            ['6421', '手续费及佣金支出', '借方', ''],
            ['6501', '提取未到期责任准备金', '借方', ''],
            ['6502', '提取保险责任准备金', '借方', ''],
            ['6511', '赔付支出', '借方', ''],
            ['6521', '保单红利支出', '借方', ''],
            ['6531', '退保金', '借方', ''],
            ['6541', '分出保费', '借方', ''],
            ['6542', '分保费用', '借方', ''],
            ['6601', '销售费用', '借方', ''],
            ['6602', '管理费用', '借方', ''],
            ['6603', '财务费用', '借方', ''],
            ['6604', '勘探费用', '借方', ''],
            ['6701', '资产减值损失', '借方', ''],
            ['6711', '营业外支出', '借方', ''],
            ['6801', '所得税费用', '借方', ''],
            ['6901', '以前年度损益调整', '借方', ''],
        ]
        account_smb_config = [
            ['0', '会计科目', '', ''],
            ['1001', '库存现金', '借方', ''],
            ['1002', '银行存款', '借方', ''],
            ['1012', '其他货币资金', '借方', ''],
            ['1101', '短期投资', '借方', ''],
            ['1101.01', '股票', '借方', '短期投资'],
            ['1101.02', '债券', '借方', '短期投资'],
            ['1101.03', '基金', '借方', '短期投资'],
            ['1101.10', '其它', '借方', '短期投资'],
            ['1121', '应收票据', '借方', ''],
            ['1122', '应收账款', '借方', ''],
            ['1123', '预付账款', '借方', ''],
            ['1131', '应收股利', '借方', ''],
            ['1132', '应收利息', '借方', ''],
            ['1221', '其他应收款', '借方', ''],
            ['1401', '材料采购', '借方', ''],
            ['1402', '在途物资', '借方', ''],
            ['1403', '原材料', '借方', ''],
            ['1404', '材料成本差异', '借方', ''],
            ['1405', '库存商品', '借方', ''],
            ['1406', '发出商品', '借方', ''],
            ['1407', '商品进销差价', '借方', ''],
            ['1408', '委托加工物资', '借方', ''],
            ['1411', '周转材料', '借方', ''],
            ['1421', '消耗性生物资产', '借方', ''],
            ['1501', '长期债券投资', '借方', ''],
            ['1511', '长期股权投资', '借方', ''],
            ['1601', '固定资产', '借方', ''],
            ['1602', '累计折旧', '贷方', ''],
            ['1604', '在建工程', '借方', ''],
            ['1605', '工程物资', '借方', ''],
            ['1606', '固定资产清理', '借方', ''],
            ['1621', '生产性生物资产', '借方', ''],
            ['1622', '生产性生物资产累计折旧', '贷方', ''],
            ['1701', '无形资产', '借方', ''],
            ['1702', '累计摊销', '贷方', ''],
            ['1801', '长期待摊费用', '借方', ''],
            ['1901', '待处理财产损溢', '借方', ''],
            ['2001', '短期借款', '贷方', ''],
            ['2201', '应付票据', '贷方', ''],
            ['2201.02', '应付暂估', '贷方', '应付票据'],
            ['2202', '应付账款', '贷方', ''],
            ['2203', '预收账款', '贷方', ''],
            ['2211', '应付职工薪酬', '贷方', ''],
            ['2211.01', '应付职工工资', '贷方', '应付职工薪酬'],
            ['2211.02', '应付奖金、津贴和补贴', '贷方', '应付职工薪酬'],
            ['2211.03', '应付福利费', '贷方', '应付职工薪酬'],
            ['2211.04', '应付社会保险费', '贷方', '应付职工薪酬'],
            ['2211.05', '应付住房公积金', '贷方', '应付职工薪酬'],
            ['2211.06', '应付工会经费', '贷方', '应付职工薪酬'],
            ['2211.07', '应付教育经费', '贷方', '应付职工薪酬'],
            ['2211.08', '非货币性福利', '贷方', '应付职工薪酬'],
            ['2211.09', '辞退福利', '贷方', '应付职工薪酬'],
            ['2211.10', '其他应付职工薪酬', '贷方', '应付职工薪酬'],
            ['2221', '应交税费', '贷方', ''],
            ['2221.01', '应交增值税', '贷方', '应交税费'],
            ['2221.01.01', '进项税额', '贷方', '应交增值税'],
            ['2221.01.02', '已交税金', '贷方', '应交增值税'],
            ['2221.01.03', '转出未交增值税', '贷方', '应交增值税'],
            ['2221.01.04', '减免税款', '贷方', '应交增值税'],
            ['2221.01.05', '销项税额', '贷方', '应交增值税'],
            ['2221.01.06', '出口退税', '贷方', '应交增值税'],
            ['2221.01.07', '进项税额转出', '贷方', '应交增值税'],
            ['2221.01.08', '出口抵减内销产品应纳税额', '贷方', '应交增值税'],
            ['2221.01.09', '转出多交增值税', '贷方', '应交增值税'],
            ['2221.02', '未交增值税', '贷方', '应交税费'],
            ['2221.03', '应交营业税', '贷方', '应交税费'],
            ['2221.04', '应交消费税', '贷方', '应交税费'],
            ['2221.05', '应交资源税', '贷方', '应交税费'],
            ['2221.06', '应交所得税', '贷方', '应交税费'],
            ['2221.07', '应交土地增值税', '贷方', '应交税费'],
            ['2221.08', '应交城市维护建设税', '贷方', '应交税费'],
            ['2221.09', '应交房产税', '贷方', '应交税费'],
            ['2221.10', '应交城镇土地使用税', '贷方', '应交税费'],
            ['2221.11', '应交车船使用税', '贷方', '应交税费'],
            ['2221.12', '应交个人所得税', '贷方', '应交税费'],
            ['2221.13', '教育费附加', '贷方', '应交税费'],
            ['2221.14', '矿产资源补偿费', '贷方', '应交税费'],
            ['2221.15', '排污费', '贷方', '应交税费'],
            ['2231', '应付利息', '贷方', ''],
            ['2232', '应付利润', '贷方', ''],
            ['2241', '其他应付款', '贷方', ''],
            ['2401', '递延收益', '贷方', ''],
            ['2501', '长期借款', '贷方', ''],
            ['2701', '长期应付款', '贷方', ''],
            ['3001', '实收资本', '贷方', ''],
            ['3002', '资本公积', '贷方', ''],
            ['3101', '盈余公积', '贷方', ''],
            ['3101.01', '法定盈余公积', '贷方', '盈余公积'],
            ['3101.02', '任意盈余公积', '贷方', '盈余公积'],
            ['3103', '本年利润', '贷方', ''],
            ['3104', '利润分配', '贷方', ''],
            ['3104.01', '其他转入', '贷方', '利润分配'],
            ['3104.02', '提取法定盈余公积', '贷方', '利润分配'],
            ['3104.03', '提取法定公益金', '贷方', '利润分配'],
            ['3104.04', '提取职工奖励及福利基金', '贷方', '利润分配'],
            ['3104.09', '提取任意盈余公积', '贷方', '利润分配'],
            ['3104.10', '应付利润', '贷方', '利润分配'],
            ['3104.15', '未分配利润', '贷方', '利润分配'],
            ['4001', '生产成本', '借方', ''],
            ['4101', '制造费用', '借方', ''],
            ['4301', '研发支出', '借方', ''],
            ['4401', '工程施工', '借方', ''],
            ['4403', '机械作业', '借方', ''],
            ['5001', '主营业务收入', '贷方', ''],
            ['5051', '其他业务收入', '贷方', ''],
            ['5111', '投资收益', '贷方', ''],
            ['5301', '营业外收入', '贷方', ''],
            ['5301.01', '非流动资产处置净收益', '贷方', '营业外收入'],
            ['5301.02', '政府补助', '贷方', '营业外收入'],
            ['5301.03', '捐赠收益', '贷方', '营业外收入'],
            ['5301.04', '盘盈收益', '贷方', '营业外收入'],
            ['5301.05', '确实无法偿付的应付账款', '贷方', '营业外收入'],
            ['5301.06', '已作坏账损失处理后又收回的应收账款', '贷方', '营业外收入'],
            ['5301.07', '出租包装物和商品的租金收入', '贷方', '营业外收入'],
            ['5301.08', '逾期未退包装物押金收益', '贷方', '营业外收入'],
            ['5301.09', '汇兑收益', '贷方', '营业外收入'],
            ['5301.10', '违约金收益', '贷方', '营业外收入'],
            ['5301.99', '其他营业外收入', '贷方', '营业外收入'],
            ['5401', '主营业务成本', '借方', ''],
            ['5402', '其他业务成本', '借方', ''],
            ['5403', '营业税金及附加', '借方', ''],
            ['5601', '销售费用', '借方', ''],
            ['5601.01', '销售人员职工薪酬', '借方', '销售费用'],
            ['5601.02', '商品维修费', '借方', '销售费用'],
            ['5601.03', '运输费', '借方', '销售费用'],
            ['5601.04', '装卸费', '借方', '销售费用'],
            ['5601.05', '包装费', '借方', '销售费用'],
            ['5601.06', '保险费', '借方', '销售费用'],
            ['5601.07', '广告费', '借方', '销售费用'],
            ['5601.08', '业务宣传费', '借方', '销售费用'],
            ['5601.09', '展览费', '借方', '销售费用'],
            ['5601.10', '运输合理损耗', '借方', '销售费用'],
            ['5601.11', '入库前挑选整理费', '借方', '销售费用'],
            ['5601.99', '其他销售费用', '借方', '销售费用'],
            ['5602', '管理费用', '借方', ''],
            ['5602.01', '管理人员职工薪酬', '借方', '管理费用'],
            ['5602.02', '办公费', '借方', '管理费用'],
            ['5602.03', '业务招待费', '借方', '管理费用'],
            ['5602.04', '员工福利', '借方', '管理费用'],
            ['5602.05', '修理费', '借方', '管理费用'],
            ['5602.06', '水电费', '借方', '管理费用'],
            ['5602.07', '差旅费', '借方', '管理费用'],
            ['5602.08', '周转材料摊销', '借方', '管理费用'],
            ['5602.09', '固定资产折旧费', '借方', '管理费用'],
            ['5602.10', '无形资产摊销费', '借方', '管理费用'],
            ['5602.11', '长期待摊费用摊销', '借方', '管理费用'],
            ['5602.12', '技术转让费', '借方', '管理费用'],
            ['5602.13', '财产保险费', '借方', '管理费用'],
            ['5602.14', '聘请中介机构费', '借方', '管理费用'],
            ['5602.15', '咨询费', '借方', '管理费用'],
            ['5602.16', '诉讼费', '借方', '管理费用'],
            ['5602.17', '研究费用', '借方', '管理费用'],
            ['5602.99', '其他管理费用', '借方', '管理费用'],
            ['5603', '财务费用', '借方', ''],
            ['5603.01', '利息费用', '借方', '财务费用'],
            ['5603.02', '汇兑损失', '借方', '财务费用'],
            ['5603.03', '银行手续费', '借方', '财务费用'],
            ['5603.04', '现金折扣', '借方', '财务费用'],
            ['5711', '营业外支出', '借方', ''],
            ['5711.01', '非流动资产处置净损失', '借方', '营业外支出'],
            ['5711.02', '赞助支出', '借方', '营业外支出'],
            ['5711.03', '捐赠支出', '借方', '营业外支出'],
            ['5711.04', '盘亏损失', '借方', '营业外支出'],
            ['5711.05', '坏账损失', '借方', '营业外支出'],
            ['5711.06', '存货毁损报废损失', '借方', '营业外支出'],
            ['5711.07', '无法收回的长期债券投资损失', '借方', '营业外支出'],
            ['5711.08', '无法收回的长期股权投资损失', '借方', '营业外支出'],
            ['5711.09', '自然灾害等不可抗力因素造成的损失', '借方', '营业外支出'],
            ['5711.10', '税收滞纳金', '借方', '营业外支出'],
            ['5711.11', '罚没损失', '借方', '营业外支出'],
            ['5711.99', '其他营业外支出', '借方', '营业外支出'],
            ['5801', '所得税费用', '借方', ''],
        ]
        res = super(AccountAccount, self).init()
        debit_list, credit_list = [], []
        parent_map = {}
        for c in account_config + account_smb_config:
            direction, value = c[2], c[1]
            if direction == '借方':
                debit_list.append(value)
            elif direction == '贷方':
                credit_list.append(value)
            parent = c[3]
            if parent != '':
                if not parent in parent_map:
                    parent_map[parent] = []
                parent_map[parent].append(value)
        ids = self.search([('name', 'in', debit_list), ('balance_direction', '=', None)])
        ids.write({'balance_direction': 'debit'})
        ids = self.search([('name', 'in', credit_list), ('balance_direction', '=', None)])
        ids.write({'balance_direction': 'credit'})
        for parent, child_list in parent_map.items():
            parent_id = self.search([('name', '=', parent)])
            if len(parent_id) == 1:
                ids = self.search([('name', 'in', child_list), ('parent_id', '=', None)])
                ids.write({'parent_id': parent_id.id})
        return res
