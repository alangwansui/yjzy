<?xml version="1.0" encoding="utf-8"?>
<odoo>


    <record id="order_track_tree_view" model="ir.ui.view">
        <field name="name">order.track.tree</field>
        <field name="model">order.track</field>
        <field name="arch" type="xml">
            <tree string="计划" editable="bottom" create="false">
                <field name="type" groups="base.group_system"/>
                <!--            <field name="date_deadline"/>-->
                <button name="open_so_id" class="akiny_text_right" type="object" icon="fa-archive" invisible="context.get('type')!='new_order_track'"/>
                <field name="so_id" readonly="1"/>

                <field name="time_receive_pi" invisible="context.get('type')!='new_order_track'"/>
                <field name="time_sent_pi" invisible="context.get('type')!='new_order_track'"/>
                <field name="time_sign_pi" invisible="context.get('type')!='new_order_track'"/>
                <field name="hegui_date" invisible="context.get('type')!='new_order_track'"/>
                 <button name="open_factory_return" class="akiny_text_right" type="object" icon="fa-archive" invisible="context.get('type')!='new_order_track'"/>
                <field name="factory_return" widget="many2many_tags"
                       invisible="context.get('type')!='new_order_track'"/>
                <field name="plan_check_ids" widget="many2many_tags" groups="base.group_system"/>
                  <button name="open_order_track" type="object" string="查看并写日志" invisible="context.get('type')!='new_order_track'"/>


                <button name="open_plan_check_line" type="object"  string="工厂检查点登记" class="oe_highlight" invisible="1"/>
                <button name="open_plan_check_line_new" type="object" string="工厂检查点登记" class="oe_highlight" invisible="context.get('type')!='order_track'"/>
                <field name="category_ids" string="异常结果" options="{'can_create':True,'color_field':'color'}"  widget="many2many_tags" invisible="context.get('type')!='order_track'"/>
                <field name="earliest_date_po_order" invisible="context.get('type')!='order_track'"/>
                <field name="latest_date_po_planned" invisible="context.get('type')!='order_track'"/>
                <field name="date_so_contract" invisible="context.get('type')!='order_track'" readonly="1"/>
                <field name="date_so_requested" invisible="context.get('type')!='order_track'" widget="date"/>
                <field name="time_contract_requested" invisible="1"/>
                <field name="time_supplier_requested" invisible="1"/>
                <field name="check_all_number" invisible="1"/>
                <field name="check_finish_number" invisible="1"/>
                <field name="check_number_percent" widget="progressbar" string="工厂检查点进度" invisible="context.get('type')!='order_track'"/>
                <field name="finish_percent" widget="progressbar" string="客户交单进度" invisible="context.get('type')!='order_track'"/>
                <field name="finish_percent_supplier" widget="progressbar" string="供应商交单进度"
                       invisible="context.get('type')!='order_track'"/>
            </tree>
        </field>
    </record>




    <record id="order_track_form" model="ir.ui.view">
        <field name="name">order.track.form</field>
        <field name="model">order.track</field>
        <field name="arch" type="xml">
            <form string="计划">
                <sheet>
                    <group invisible="not context.get('order_track')">
                    <group invisible="not context.get('order_track')">
                        <field name="type" groups="base.group_system"/>
                        <field name="so_id" readonly="1"/>
                        <field name="time_receive_pi" string="收到客户订单"/>
                        <field name="time_sent_pi"/>
                        <field name="time_sign_pi"/>
                    </group>
                    <group>
                        <field name="hegui_date" readonly="1"/>
                        <field name="earliest_date_po_order" string="最早供应商下单"/>
                        <field name="latest_date_po_planned" string="最迟供应商下单"/>
                    </group>
                    </group>
                    <notebook colspan="4">
                        <page string="General Information" invisible="not context.get('return')">
                            <field name="plan_check_ids" deldete="false" create="false">
                                <tree editable="bottom" delete="false">
                                    <field name="order_track_id" groups="base.group_system"/>
                                    <field name="so_id" groups="base.group_system"/>
                                    <field name="po_id" readonly="1"/>
                                    <field name="plan_check_line" groups="base.group_system"/>
                                    <field name="date_factory_return"/>
                                </tree>
                            </field>
                        </page>
                        <page string="采购合同" invisible="not context.get('order_track')">
                            <field name="po_ids" readonly="1">
                                <tree>
                                    <field name="message_unread" invisible="1"/>
                                    <field name="name" string="流水码" groups="base.group_system" invisible="1"/>
                                    <field name="contract_code" string="合同编号"/>
                                    <field name="partner_id"/>
                                    <field name="date_order" string="下单日期" widget="date" invisible="1"/>
                                    <field name="create_date" widget="date" invisible="1"/>
                                    <field name="date_order" widget="date"/>
                                    <field name="date_planned" invisible="context.get('quotation_only', False)"
                                           string="交期" widget="date"/>
                                    <field name="date_factory_return" string="工厂回传日"/>
                                    <field name="origin" invisible="1"/>
                                    <field name="amount_untaxed" sum="Total Untaxed amount" string="Untaxed"
                                           widget="monetary" invisible="1"/>
                                    <field name="amount_total" sum="Total amount" string="金额" widget="monetary"/>
                                    <field name="balance" string="预付余额"/>
                                    <field name="currency_id" invisible="1"/>
                                    <field name="state" invisible="1"/>
                                    <field name="delivery_status" invisible="1"/>
                                    <field name="include_tax"/>
                                    <field name="payment_term_id" attrs="{}" invisible="1"/>
                                    <field name="sale_uid"/>
                                    <field name="sale_assistant_id" invisible="1"/>
                                    <field name="purchaser_date"/>
                                    <field name="so_id_state" string="销售审批状态" invisible="1"/>
                                    <field name="gongsi_id" string="采购主体" invisible="1"/>
                                    <field name="supplierinfo_ids" widget="many2many_tags" invisible="1"/>
                                    <field name="invoice_status"
                                           invisible="1"/><!--invisible="not context.get('show_purchase', True)"-->
                                    <field name="company_id" groups="base.group_system" invisible="1"
                                           options="{'no_create': True}"/>
                                </tree>
                            </field>
                        </page>

                    </notebook>
                      <footer invisible="not context.get('open')">
                            <button name="action_save_test" type="object" class="oe_highlight" string="保存并关闭"/>
                          <button string="关闭" class="btn-primary" special="cancel"/>
                        </footer>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>


    <record id="order_track_form_plan_check_ids" model="ir.ui.view">
        <field name="name">order.track.form</field>
        <field name="model">order.track</field>
        <field name="arch" type="xml">
            <form string="计划" create="false">
                <sheet>

                            <field name="plan_check_ids" nolabel="1">
                                <tree editable="bottom" delete="false">
                                    <field name="order_track_id" groups="base.group_system"/>
                                    <field name="so_id" groups="base.group_system"/>
                                    <field name="po_id" readonly="1"/>
                                    <field name="plan_check_line" groups="base.group_system"/>
                                    <field name="date_deadline"/>
                                    <field name="date_finish"/>
                                    <field name="state"/>
                                    <button name="open_plan_check_ids" type="object" string="检查点检查登记"/>
                                </tree>
                            </field>

                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>


    <record id="plan_check_tree_view" model="ir.ui.view">
        <field name="name">plan.check.tree</field>
        <field name="model">plan.check</field>
        <field name="arch" type="xml">
            <tree string="检查点">
                <field name="date_deadline"/>
                <field name="so_id"/>
            </tree>
        </field>
    </record>


    <record id="plan_check_form" model="ir.ui.view">
        <field name="name">plan.check.form</field>
        <field name="model">plan.check</field>
        <field name="arch" type="xml">
            <form string="检查点">
                <sheet>
                    <notebook colspan="4">
                        <page string="General Information">
                            <field name="plan_check_line">
                                <tree>
                                    <field name="activity_type_1_id"/>
                                    <button name="open_activity_id_plan" class="akiny_text_right" type="object" icon="fa-archive" attrs="{'invisible':[('plan_check_id','=',False)]}"/>

                                    <field name="date_deadline"/>
                                    <button name="open_activity_id_finish" class="akiny_text_right" type="object" icon="fa-archive" attrs="{'invisible':[('plan_check_id','=',False)]}"/>

                                    <field name="date_finish"/>
                                    <field name="plan_check_id"/>

                                    <button name="open_activity_id" type="object" string="登记该项检查点" groups="base.group_system" attrs="{'invisible':[('plan_check_id','=',False)]}"/>
                                </tree>
                            </field>
                        </page>

                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="plan_check_line_tree_view" model="ir.ui.view">
        <field name="name">plan.check.line.tree</field>
        <field name="model">plan.check.line</field>
        <field name="arch" type="xml">
            <tree string="检查点">
                <field name="po_id"/>
                <field name="activity_type_1_id"/>
                <button name="open_activity_id_plan" class="akiny_text_right" type="object" icon="fa-archive" />
                <field name="date_deadline"/>
                <button name="open_activity_id_finish" class="akiny_text_right" type="object" icon="fa-archive" />
                <field name="date_finish"/>
<field name="state"/>
                <button name="open_activity_id" type="object" string="登记该项检查点" groups="base.group_system"/>
            </tree>
        </field>
    </record>


    <record id="plan_check_line_form" model="ir.ui.view">
        <field name="name">plan.check.line.form</field>
        <field name="model">plan.check.line</field>
        <field name="arch" type="xml">
            <form string="检查点">
                <sheet>
                    <group>
                        <field name="po_id"/>
                <field name="activity_type_1_id"/>
                <button name="open_activity_id_plan" class="akiny_text_right" type="object" icon="fa-archive" />
                <field name="date_deadline"/>
                <button name="open_activity_id_finish" class="akiny_text_right" type="object" icon="fa-archive" />
                <field name="date_finish"/>

                <button name="open_activity_id" type="object" string="登记该项检查点" groups="base.group_system"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="action_plan_check_line" model="ir.actions.act_window">
        <field name="name">检查点</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">plan.check.line</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'group_by':'po_id'}</field>
        <field name="view_ids" eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('plan_check_line_tree_view')}),
                           (0, 0, {'view_mode': 'form', 'view_id': ref('plan_check_line_form')})]"/>
    </record>

    <record id="action_new_order_track" model="ir.actions.act_window">
        <field name="name">新订单下单前跟踪</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">order.track</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('type','=','new_order_track')]</field>
        <field name="context">{'type': 'new_order_track','factory_return':1}</field>
         <field name="view_ids" eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('order_track_tree_view')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('order_track_form')})]"/>

    </record>

    <record id="action_order_track" model="ir.actions.act_window">
        <field name="name">订单跟踪</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">order.track</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('type','=','order_track')]</field>
        <field name="context">{'type': 'order_track',}</field>
                 <field name="view_ids" eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('order_track_tree_view')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('order_track_form')})]"/>

    </record>

 <menuitem id="menu_order_track_root" name="合同跟踪"  sequence="99"  groups="sales_team.group_manager"/>
    <menuitem id="menu_new_order_track" name="新订单下单前跟踪" parent="menu_order_track_root" action="action_new_order_track"
              sequence="1"/>
    <menuitem id="menu_order_track" name="订单跟踪" parent="menu_order_track_root" action="action_order_track" sequence="2"/>
    <menuitem id="menu_plan_check" name="检查点" parent="base.menu_users" action="action_plan_check_line" sequence="3"/>


</odoo>